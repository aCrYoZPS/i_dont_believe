@page "/profile"
@using System.Security.Claims
@using IDontBelieve.Frontend.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject IAuthService AuthService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation

<PageTitle>Profile</PageTitle>

<h3>User Profile</h3>

@if (user.Identity.IsAuthenticated)
{
    <div class="profile-info">
        <p><strong>Username:</strong> @user.FindFirst(ClaimTypes.Name)?.Value</p>
        <p><strong>Email:</strong> @user.FindFirst(ClaimTypes.Email)?.Value</p>
        <p><strong>User ID:</strong> @user.FindFirst(ClaimTypes.NameIdentifier)?.Value</p>
    </div>
    <button class="btn btn-danger" @onclick="Logout">Logout</button>
}
else
{
    <p>You are not logged in.</p>
    <a href="/login" class="btn btn-primary">Login</a>
}

@code {
    private ClaimsPrincipal user = new ClaimsPrincipal(new ClaimsIdentity());

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        user = authState.User;
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/", true);
    }
}